<template>
    <div>
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header pull-left">
                    <a class="navbar-brand" href="/dashboard">
                        <svg viewBox="0 0 218 42" class="hidden-xs">
                            <g>
                                <path fill="#feae3b" d="M40.433,19.072h17.324c0.559,0,1.011-0.452,1.011-1.01v-6.705c0-0.559-0.452-1.011-1.011-1.011H40.433
                                    c-0.557,0-1.01,0.452-1.01,1.011v6.705C39.423,18.62,39.876,19.072,40.433,19.072z"/>
                                <path fill="#feae3b" d="M19.102,19.072h17.323c0.559,0,1.01-0.452,1.01-1.01v-6.705c0-0.559-0.451-1.011-1.01-1.011H19.102
                                    c-0.559,0-1.011,0.452-1.011,1.011v6.705C18.091,18.62,18.543,19.072,19.102,19.072z"/>
                                <path fill="#feae3b" d="M3.831,19.072h11.418c0.558,0,1.01-0.452,1.01-1.01v-6.705c0-0.559-0.452-1.011-1.01-1.011H3.831
                                    c-0.559,0-1.01,0.452-1.01,1.011v6.705C2.821,18.62,3.272,19.072,3.831,19.072z"/>
                                <path fill="#feae3b" d="M57.758,31.232H40.434c-0.558,0-1.011,0.453-1.011,1.011v6.704c0,0.558,0.453,1.01,1.011,1.01h17.324
                                    c0.558,0,1.011-0.452,1.011-1.01v-6.704C58.769,31.685,58.315,31.232,57.758,31.232z"/>
                                <path fill="#feae3b" d="M36.425,31.232H19.102c-0.558,0-1.01,0.453-1.01,1.011v6.704c0,0.558,0.452,1.01,1.01,1.01h17.323
                                    c0.559,0,1.012-0.452,1.012-1.01v-6.704C37.437,31.685,36.983,31.232,36.425,31.232z"/>
                                <path fill="#feae3b" d="M15.249,31.232H3.831c-0.558,0-1.01,0.453-1.01,1.011v6.704c0,0.558,0.452,1.01,1.01,1.01h11.418
                                    c0.558,0,1.01-0.452,1.01-1.01v-6.704C16.259,31.685,15.807,31.232,15.249,31.232z"/>
                                <path fill="#feae3b" d="M21.155,29.556c0.558,0,1.01-0.452,1.01-1.01v-6.705c0-0.558-0.452-1.01-1.01-1.01H3.831
                                    c-0.559,0-1.01,0.452-1.01,1.01v6.705c0,0.558,0.451,1.01,1.01,1.01H21.155z"/>
                                <path fill="#feae3b" d="M25.296,20.832c-0.559,0-1.012,0.452-1.012,1.01v6.705c0,0.558,0.453,1.01,1.012,1.01h17.323
                                    c0.558,0,1.01-0.452,1.01-1.01v-6.705c0-0.558-0.452-1.01-1.01-1.01H25.296z"/>
                                <path fill="#feae3b" d="M57.757,20.832H46.339c-0.557,0-1.01,0.452-1.01,1.01v6.705c0,0.558,0.453,1.01,1.01,1.01h11.418
                                    c0.559,0,1.011-0.452,1.011-1.01v-6.705C58.768,21.284,58.315,20.832,57.757,20.832z"/>
                            </g>
                            <g>
                                <path fill="#414042" d="M71.249,21.136c0-0.809,0.361-1.169,1.17-1.169h4.902v19.77h8.721v-19.77h4.998
                                    c0.787,0,1.17,0.382,1.17,1.169v18.601h8.623V18.023c0-4.592-2.279-6.921-6.777-6.921H69.354c-4.528,0-6.825,2.312-6.825,6.873
                                    v21.761h8.72V21.136z"/>
                                <path fill="#414042" d="M110.188,39.737h12.303c4.435,0,6.683-2.296,6.683-6.825V18.023c0-4.592-2.281-6.921-6.778-6.921h-12.351
                                    c-4.529,0-6.825,2.312-6.825,6.873v15.127C103.219,37.505,105.563,39.737,110.188,39.737z M112.034,29.657v-8.521
                                    c0-0.809,0.361-1.169,1.17-1.169h6.08c0.807,0,1.168,0.36,1.168,1.169v8.616c0,0.809-0.361,1.169-1.168,1.169h-6.08
                                    C112.405,30.921,112.034,30.52,112.034,29.657z"/>
                                <path fill="#414042" d="M138.383,39.737h19.032V2.821H148.6v8.281h-10.36c-4.528,0-6.825,2.312-6.825,6.873v15.127
                                    C131.414,37.505,133.759,39.737,138.383,39.737z M140.229,29.657v-8.521c0-0.809,0.36-1.169,1.17-1.169h7.2v10.955h-7.2
                                    C140.601,30.921,140.229,30.52,140.229,29.657z"/>
                                <path fill="#414042" d="M166.914,39.737h11.824c4.433,0,6.681-2.296,6.681-6.825V11.103H176.7v18.649
                                    c0,0.809-0.361,1.169-1.17,1.169h-5.6c-0.799,0-1.17-0.402-1.17-1.265V11.103h-8.816v22
                                    C159.944,37.505,162.29,39.737,166.914,39.737z"/>
                                <rect x="187.997" y="2.821" fill="#414042" width="8.814" height="36.916"/>
                                <path fill="#414042" d="M206.31,11.103c-4.625,0-6.873,2.249-6.873,6.873v21.761h8.863V21.088c0-0.809,0.361-1.169,1.17-1.169
                                    h6.394v-8.816H206.31z"/>
                            </g>
                        </svg>
                        <svg viewBox="0 0 65 42" class="visible-xs-block">
                            <g>
                                <path fill="#feae3b" d="M40.433,19.072h17.324c0.559,0,1.011-0.452,1.011-1.01v-6.705c0-0.559-0.452-1.011-1.011-1.011H40.433
                                    c-0.557,0-1.01,0.452-1.01,1.011v6.705C39.423,18.62,39.876,19.072,40.433,19.072z"/>
                                <path fill="#feae3b" d="M19.102,19.072h17.323c0.559,0,1.01-0.452,1.01-1.01v-6.705c0-0.559-0.451-1.011-1.01-1.011H19.102
                                    c-0.559,0-1.011,0.452-1.011,1.011v6.705C18.091,18.62,18.543,19.072,19.102,19.072z"/>
                                <path fill="#feae3b" d="M3.831,19.072h11.418c0.558,0,1.01-0.452,1.01-1.01v-6.705c0-0.559-0.452-1.011-1.01-1.011H3.831
                                    c-0.559,0-1.01,0.452-1.01,1.011v6.705C2.821,18.62,3.272,19.072,3.831,19.072z"/>
                                <path fill="#feae3b" d="M57.758,31.232H40.434c-0.558,0-1.011,0.453-1.011,1.011v6.704c0,0.558,0.453,1.01,1.011,1.01h17.324
                                    c0.558,0,1.011-0.452,1.011-1.01v-6.704C58.769,31.685,58.315,31.232,57.758,31.232z"/>
                                <path fill="#feae3b" d="M36.425,31.232H19.102c-0.558,0-1.01,0.453-1.01,1.011v6.704c0,0.558,0.452,1.01,1.01,1.01h17.323
                                    c0.559,0,1.012-0.452,1.012-1.01v-6.704C37.437,31.685,36.983,31.232,36.425,31.232z"/>
                                <path fill="#feae3b" d="M15.249,31.232H3.831c-0.558,0-1.01,0.453-1.01,1.011v6.704c0,0.558,0.452,1.01,1.01,1.01h11.418
                                    c0.558,0,1.01-0.452,1.01-1.01v-6.704C16.259,31.685,15.807,31.232,15.249,31.232z"/>
                                <path fill="#feae3b" d="M21.155,29.556c0.558,0,1.01-0.452,1.01-1.01v-6.705c0-0.558-0.452-1.01-1.01-1.01H3.831
                                    c-0.559,0-1.01,0.452-1.01,1.01v6.705c0,0.558,0.451,1.01,1.01,1.01H21.155z"/>
                                <path fill="#feae3b" d="M25.296,20.832c-0.559,0-1.012,0.452-1.012,1.01v6.705c0,0.558,0.453,1.01,1.012,1.01h17.323
                                    c0.558,0,1.01-0.452,1.01-1.01v-6.705c0-0.558-0.452-1.01-1.01-1.01H25.296z"/>
                                <path fill="#feae3b" d="M57.757,20.832H46.339c-0.557,0-1.01,0.452-1.01,1.01v6.705c0,0.558,0.453,1.01,1.01,1.01h11.418
                                    c0.559,0,1.011-0.452,1.011-1.01v-6.705C58.768,21.284,58.315,20.832,57.757,20.832z"/>
                            </g>
                        </svg>
                    </a>
                </div>
                <ul class="nav navbar-nav pull-right">
                    <!-- Menu -->
                    <li class="dropdown menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                            <i class="fa fa-th fa-lg" aria-hidden="true"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-right list-inline">
                            <!-- <li :class="{'active': activeLink == 'dashboard'}">
                                <a href="/dashboard">
                                    <i class="mdi mdi-dashboard mdi-3x"></i>
                                    <br>
                                    <span>Dashboard</span>
                                </a>
                            </li> -->
                            <li :class="{'active': activeLink == 'autoparts/sales'}" v-if="user.hasPermission['read-sales']">
                                <a href="/autoparts/sales">
                                    <i class="mdi mdi-monetization-on mdi-3x"></i>
                                    <br>
                                    <span>Sales</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'autoparts/inventory'}" v-if="user.hasPermission['read-inventory']">
                                <a href="/autoparts/inventory">
                                    <i class="mdi mdi-widgets mdi-3x"></i>
                                    <br>
                                    <span>Inventory</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'autoparts/lists'}" v-if="user.hasPermission['read-inventory-lists']">
                                <a href="/autoparts/lists">
                                    <i class="mdi mdi-list mdi-3x"></i>
                                    <br>
                                    <span>Lists</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'tasks'}" v-if="user.hasPermission['read-tasks']">
                                <a href="/tasks">
                                    <i class="mdi mdi-assignment mdi-3x"></i>
                                    <br>
                                    <span>Tasks</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'news'}" v-if="user.hasPermission['read-news']">
                                <a href="/news">
                                    <i class="mdi mdi-whatshot mdi-3x"></i>
                                    <br>
                                    <span>News</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'events'}" v-if="user.hasPermission['read-events']">
                                <a href="/events">
                                    <i class="mdi mdi-event mdi-3x"></i>
                                    <br>
                                    <span>Events</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'files'}" v-if="user.hasPermission['read-files']">
                                <a href="/files">
                                    <i class="mdi mdi-folder mdi-3x"></i>
                                    <br>
                                    <span>Files</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'contacts'}" v-if="user.hasPermission['read-contacts']">
                                <a href="/contacts">
                                    <i class="mdi mdi-contacts mdi-3x"></i>
                                    <br>
                                    <span>Contacts</span>
                                </a>
                            </li>
                            <hr>
                            <li :class="{'active': activeLink == 'users'}" v-if="user.hasPermission['read-users']">
                                <a href="/users">
                                    <i class="mdi mdi-people mdi-3x"></i>
                                    <br>
                                    <span>Users</span>
                                </a>
                            </li>
                            <li :class="{'active': activeLink == 'roles'}" v-if="user.hasPermission['read-roles']">
                                <a href="/roles">
                                    <i class="mdi mdi-vpn-key mdi-3x"></i>
                                    <br>
                                    <span>Roles</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- Notifications -->
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" @click="markAsRead">
                            <i class="fa fa-bell fa-lg"></i>
                            <span class="label label-danger" v-show="unReadNotifications.length>0">{{unReadNotifications.length}}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-right notifications">
                            <li class="dropdown-header">Notifications</li>
                            <notifications class="notifications-list"></notifications>
                            <li class="text-center">
                                <a href="/notifications"><small>View all notifications</small></a>
                            </li>
                        </ul>
                    </li>
                    <!-- User -->
                    <li class="dropdown user">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                            <img :src="user.avatar_url" alt="">
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
                            <li class="dropdown-header">
                                <p class="lead">{{user.name}}</p>
                                <small class="text-muted">{{user.email}}</small>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a :href="`/profile/${user.id}`">
                                    <i class="fa fa-fw fa-user-circle-o"></i> Profile
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="https://modulr.slack.com" target="_blank">
                                    <i class="fa fa-fw fa-slack"></i> Help
                                </a>
                            </li>
                            <li>
                                <a href="http://docs.modulr.io" target="_blank">
                                    <i class="fa fa-fw fa-book"></i> Documentation
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="#" @click.prevent="logout">
                                    <i class="fa fa-fw fa-sign-out"></i> Sign out
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <vue-snotify></vue-snotify>
    </div>
</template>

<script>
    export default {
        data() {
            return {
                user: Laravel.user,
                notifications: Laravel.notifications,
                unReadNotifications: Laravel.unReadNotifications,
            }
        },
        mounted() {
            Echo.private('App.User.' + this.user.id)
                .notification((e) => {
                    this.notifications.unshift({data:e});
                    this.unReadNotifications.unshift({data:e});

                    Notification.requestPermission().then(function(result) {
                        if (result === "granted") {
                            var options = {
                                body: e.message.title,
                                icon: '/img/icon/favicon-96x96.png',
                                badge: '/img/icon/favicon-16x16.png',
                                image: e.message.userAvatarUrl,
                            }
                            if (e.message.imageUrl) {
                                options.image = e.message.imageUrl;
                            }
                            new Notification(e.message.userName, options);
                        }
                    });
                });

            // Echo.channel('news')
            //     .listen('StatusLiked', (e) => {
            //         this.notifications.push(e.message);
            //
            //         if (Notification.permission === "granted") {
            //             var options = {
            //                 body: e.message.message.title,
            //             }
            //             var notification = new Notification(e.message.user.name, options);
            //         }
            //     });
        },
        computed: {
            activeLink () {
                var str = window.location.pathname
                var link = str.slice(1)
                return link
            }
        },
        methods: {
            logout () {
                axios.post('/logout')
                .then(response => {
                    location.href = '/';
                });
            },
            markAsRead () {
                axios.get('/notifications/markAsRead')
                .then(response => {
                    this.unReadNotifications = [];
                });
            }
        }
    }
</script>
